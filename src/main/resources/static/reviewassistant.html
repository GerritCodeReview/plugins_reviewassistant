<dom-module id="reviewassistant-htmllabel">
  <template>
    <span>{{content}}</span>
  </template>
  <script>
    Polymer({
      is: 'reviewassistant-htmllabel',
      properties: {
        content: {
          type: String,
          observer: '_contentChanged'}
      },
      ready() {
        this.innerHTML = this.content;
      },
      _contentChanged() {
        this.innerHTML = this.content;
      },
    });
  </script>
</dom-module>

<dom-module id="reviewassistant-advice">
  <style>
    .review-advice {
      max-width: 20em;
      display: block;
      padding-left: 1.5em;
      padding-right: 0.5em;
    }
  </style>
  <template>
    <template is="dom-if" if="[[_isVisible(change, revision)]]">
      <div class="separatedSection gr-change-metadata">
        <section class="gr-change-metadata">
          <span class="title gr-change-metadata">ReviewAssistant</span>
        </section>
        <span class="review-advice">
          <iron-icon src="/plugins/reviewassistant/static/loading.gif" hidden="[[!loading]]">
          </iron-icon>
          <reviewassistant-htmllabel class="gr-change-metadata" hidden="[[loading]]" content="[[advice]]" >
          </reviewassistant-htmllabel>
        </span>
      <div>
    </template>
  </template>
  <script>
    Polymer({
      is: 'reviewassistant-advice',
      properties: {
        loading: Boolean,
        advice: String,
      },
      attached() {
        this.loading = true;
        var url = "/changes/" + this.change._number + "/revisions/" + this.revision._number + "/reviewassistant~advice";
        this.plugin.restApi().get(url).then( (resp) => {
          this.advice = resp;
          this.loading = false;
        });
      },
      _isVisible(change, revision) {
        return !((change.status != 'NEW') || (change.current_revision != revision.commit.commit));
      },
    });
  </script>
</dom-module>

<dom-module id="reviewassistant">
  <script>
    Gerrit.install(plugin => {
      plugin.registerCustomComponent('change-metadata-item', 'reviewassistant-advice');
    });
  </script>
</dom-module>
